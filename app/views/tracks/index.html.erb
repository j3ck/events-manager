<h1>Listing tracks</h1>

<div class="search__form">
  <%= form_tag tracks_path, method: :get do %>
    <p>
      <%= text_field_tag :query, params[:query], data: {autocomplete_source: search_path} %>
    </p>
  <% end %>
</div>

  <% @tracks.each do |track| %>
      <%= track.id %>
      <iframe id="sc-widget" width="100%" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/<%= track.id %>&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=false"></iframe>

      <%= form_for(Track.new(id: track.id, event_id: event_id) ) do |f| %>
        <div><%= f.hidden_field :id %></div>
        <div><%= f.hidden_field :event_id %></div>
        <%= f.submit "add to playlist" %>
      <% end %>
  <% end %>

<br>

<%= link_to 'New Track', new_track_path %>
<script src="http://w.soundcloud.com/player/api.js" type="text/javascript"></script>
  <script type="text/javascript">
  (function(){
    var widgetIframe = document.getElementById('sc-widget'),
        widget       = SC.Widget(widgetIframe);

    widget.bind(SC.Widget.Events.READY, function() {
      widget.bind(SC.Widget.Events.PLAY, function() {
        // get information about currently playing sound
        widget.getCurrentSound(function(currentSound) { 
          console.log('sound ' + currentSound.get('') + 'began to play');
        });
      });
      // get current level of volume
      widget.getVolume(function(volume) {
        console.log('current volume value is ' + volume);
      });
      // set new volume level
      widget.setVolume(10);
    });

  }());
  </script>